<!DOCTYPE html>
<html lang="en">
  <head>
    <meta name="description" content="GHA School Shop">

    <!-- Open Graph Meta-->
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="Great Heights Academy">
    <meta property="og:title" content="Great Heights Academy School Shop">

    <meta property="og:description" content="GHA School Shop">
    <title>GHA School Shop</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Main CSS-->
    <link rel="stylesheet" type="text/css" href="static/css/main.css">
    <!-- Font-icon css-->
    <link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- <link rel="stylesheet" type="text/css" href="static/css/font-awesome.min.css"> -->
  </head>
  <body class="app sidebar-mini rtl">
    <!-- Navbar-->
    <header class="app-header"><a class="app-header__logo" href="index.html">GHA School Shop</a>
      <!-- Sidebar toggle button--><a class="app-sidebar__toggle" href="#" data-toggle="sidebar" aria-label="Hide Sidebar"></a>
      <!-- Navbar Right Menu-->
      <ul class="app-nav">
        <!-- User Menu-->
        <li class="dropdown"><a class="app-nav__item" href="#" data-toggle="dropdown" aria-label="Open Profile Menu"><i class="fa fa-user fa-lg"></i></a>
          <ul class="dropdown-menu settings-menu dropdown-menu-right">
            <li><a class="dropdown-item" href="index.html"><i class="fa fa-sign-out fa-lg"></i> Logout</a></li>
          </ul>
        </li>
      </ul>
    </header>
    <!-- Sidebar menu-->
    <div class="app-sidebar__overlay" data-toggle="sidebar"></div>
    <aside class="app-sidebar">
      <div class="app-sidebar__user"><img class="app-sidebar__user-avatar" src="static/images/user.png" alt="User Image">
        <div>
          <p class="app-sidebar__user-name">Admin Admin</p>
          <p class="app-sidebar__user-designation">Shop Admin</p>
        </div>
      </div>
      <ul class="app-menu">
        <li><a class="app-menu__item" href="dashboard.html"><i class="app-menu__icon fa fa-dashboard"></i><span class="app-menu__label">Dashboard</span></a></li>
        <li class="treeview is-expanded"><a class="app-menu__item" href="#" data-toggle="treeview"><i class="app-menu__icon fa fa-laptop"></i><span class="app-menu__label">Student Management</span><i class="treeview-indicator fa fa-angle-right"></i></a>
          <ul class="treeview-menu">
            <li><a class="treeview-item active" href="page-student-list.html"><i class="icon fa fa-circle-o"></i> Student List</a></li>
            <li><a class="treeview-item" href="page-student-add.html"><i class="icon fa fa-circle-o"></i> Add New Student</a></li>
            
          </ul>
        </li>
        <li class="treeview"><a class="app-menu__item" href="#" data-toggle="treeview"><i class="app-menu__icon fa fa-laptop"></i><span class="app-menu__label">Staff Management</span><i class="treeview-indicator fa fa-angle-right"></i></a>
          <ul class="treeview-menu">
            <li><a class="treeview-item" href="page-user-list.html"><i class="icon fa fa-circle-o"></i> Staff List</a></li>
            <li><a class="treeview-item" href="page-user-add.html"><i class="icon fa fa-circle-o"></i> Add New Staff</a></li>
            
          </ul>
        </li>
        <li class="treeview"><a class="app-menu__item" href="#" data-toggle="treeview"><i class="app-menu__icon fa fa-edit"></i><span class="app-menu__label">My Shop</span><i class="treeview-indicator fa fa-angle-right"></i></a>
          <ul class="treeview-menu">
            <li><a class="treeview-item" href="#"><i class="icon fa fa-circle-o"></i> Stock Management</a></li>
            <li><a class="treeview-item" href="page-shop-purchase.html"><i class="icon fa fa-circle-o"></i> My Purchases</a></li>
          </ul>
        </li>
        
        <li class="treeview"><a class="app-menu__item" href="#" data-toggle="treeview"><i class="app-menu__icon fa fa-file-text"></i><span class="app-menu__label">Reports</span><i class="treeview-indicator fa fa-angle-right"></i></a>
          <ul class="treeview-menu">
            <li><a class="treeview-item" href="page-report-transaction.html"><i class="icon fa fa-circle-o"></i> Shopping Report</a></li>
            <li><a class="treeview-item" href="page-report-comprehensive.html"><i class="icon fa fa-circle-o"></i> Comprehensive Report</a></li>
            
          </ul>
        </li>
      </ul>
    </aside>
    <main class="app-content">
      <div class="app-title">
        <div>
          <h1><i class="fa fa-laptop"></i> Student Information</h1>
          <p>Full Student Information</p>
        </div>
        <ul class="app-breadcrumb breadcrumb">
          <li class="breadcrumb-item"><i class="fa fa-home fa-lg"></i></li>
          <li class="breadcrumb-item">Student</li>
          <li class="breadcrumb-item"><a href="#">Information</a></li>
        </ul>
      </div>
      <div class="row">
        <div class="col-md-12">
          <div class="tile" id="studentInfo">
            <!-- <h3 class="tile-title">Aisha Babakura Babagana</h3>
            <div class="tile-body">
                <table class="table table-sm">
                      <tr>
                        <td rowspan='4'>
                            <img src="static/images/student/11_408.png" style="height: 150px; width: 150px;" class="img-fluid rounded-circle" alt="Student"> 
                        </td>
                      </tr>           
                      <tr>
                        <th>House</th>
                        <td>Blue</td>
                        <th>Class</th>
                        <td>JSS 1A</td>
                        <th>Withrawal Limit</th>
                        <td>₦ 800.00</td>
                      </tr>
                      <tr>
                        <th>Account Balance</th>
                        <td>₦ 2, 000.00</td>
                        <th>Last Deposit</th>
                        <td>₦ 2, 000.00</td>
                        <td>21-09-2016</td>
                        <td>
                            <div class="btn-group" role="group" aria-label="Button group with nested dropdown">
                                <button class="btn btn-info" type="button">More Actions</button>
                                <div class="btn-group" role="group">
                                  <button class="btn btn-info dropdown-toggle" id="btnGroupDrop3" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></button>
                                  <div class="dropdown-menu dropdown-menu-right">
                                      <a class="dropdown-item" href="page-student-update.html">Update Student</a>
                                      <a class="dropdown-item" href="page-student-transaction.html">All Transactions</a>
                                      <a class="dropdown-item" href="page-student-deposit.html">All Deposits</a>
                                      <a class="dropdown-item" href="page-student-accountstatement.html">Individual Report</a>
                                  </div>
                                </div>
                            </div>
                        </td>
                      </tr>
                      
                  </table>    
            </div> -->
          </div>
        </div>
        <div class="clearfix"></div>
        <div class="col-md-12">
            <div class="tile">
              <h3 class="tile-title">Special Shoppings</h3>
              <div class="tile-body">
                <form class="row" name="specialForm" id="specialForm">
                    <div class="form-group col-4">
                      <label class="control-label">Amount</label>
                        <label class="sr-only" for="exampleInputAmount">Amount (in Naira)</label>
                        <div class="input-group">
                          <div class="input-group-prepend"><span class="input-group-text">₦</span></div>
                          <input class="form-control" id="amount" name="amount" type="text" placeholder="Amount">
                          <div class="input-group-append"><span class="input-group-text">.00</span></div>
                        </div>
                    </div>
                    <div class="form-group col-6">
                        <label class="control-label">Description</label>
                        <input class="form-control" type="text" name="item" id="item" placeholder="Enter Description">
                    </div>
                    <div class="form-group col-2 align-self-end">
                      <button class="btn btn-primary" type="submit"><i class="fa fa-fw fa-lg fa-check-circle"></i>Save</button>
                    </div>
                  </form>
              </div>
              <div class="tile-footer">
                  <h3 id="std">Special Shopping History ( Babakura Babagana 13/001)</h3>
                  <div class="table-responsive">
                    <table class="table">
                      <thead>
                        <tr>
                          <th>#</th>
                          <th>Item Name</th>
                          <th>Description</th>
                          <th>Item Amount</th>
                          <th>Transaction Date</th>
                        </tr>
                      </thead>
                      <tbody id="specialShoppingList">
                        
                      </tbody>
                    </table>
                  </div>
              </div>
            </div>
        </div>
      </div>
    </main>
    <!-- Essential javascripts for application to work-->
    <script src="static/js/jquery-3.2.1.min.js"></script>
    <script src="static/js/popper.min.js"></script>
    <script src="static/js/bootstrap.min.js"></script>
    <script src="static/js/main.js"></script>
    <!-- The javascript plugin to display page loading on top-->
    <script src="static/js/plugins/pace.min.js"></script>
    <!-- Page specific javascripts-->
    <script type="text/javascript" src="static/js/plugins/bootstrap-notify.min.js"></script>
    <script type="text/javascript" src="static/js/plugins/sweetalert.min.js"></script>
    <script>
    $(document).ready(function(){
      var studentID = localStorage.getItem('currentStudent');
       
        req = $.ajax({
          url: 'http://localhost:5000/students',
          type:'get',
          data: {studentID: studentID},
        });
        req.done(function(data){
            if(data.deposits.length > 0){
              deposit = data.deposits[data.deposits.length - 1]['amount'];
              deposit_date = data.deposits[data.deposits.length - 1]["date"];
            }else{
              deposit = 0;
              deposit_date = 0;
            }

          localStorage.setItem('currentStudentRegNum',data.regNum);
          $('#studentInfo').html('<h3 class="tile-title">'+data.name+'</h3><div class="tile-body"><table class="table table-sm"><tr><td rowspan="4"> <img src="http://127.0.0.1:5000/static/images/'+data.passport+'" style="height: 150px; width: 150px;" class="img-fluid rounded-circle" alt="Student"></td></tr><tr><th>House</th><td>'+data.house+'</td><th>Class</th><td>'+data.class+'</td><th>Withrawal Limit</th><td>₦ '+data.weeklyLimit+'.00</td></tr><tr><th>Account Balance</th><td>₦ '+data.balance+'.00</td><th>Last Deposit</th><td>₦ '+deposit+'.00</td><td>'+deposit_date+'</td><td><div class="btn-group" role="group" aria-label="Button group with nested dropdown"> <button class="btn btn-info" type="button">More Actions</button><div class="btn-group" role="group"> <button class="btn btn-info dropdown-toggle" id="btnGroupDrop3" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></button><div class="dropdown-menu dropdown-menu-right"> <a class="dropdown-item" href="page-student-update.html">Update Student</a> <a class="dropdown-item" href="page-student-transaction.html">All Transactions</a> <a class="dropdown-item" href="page-student-deposit.html">All Deposits</a> <a class="dropdown-item" href="page-student-accountstatement.html">Individual Report</a></div></div></div></td></tr></table></div>');

         
          totalAmount = 0;
          count = 1;
          data.transactions.forEach(function(item){
            if(item['item'] !== null){
              totalAmount = totalAmount + item['amount'];
              $('#specialShoppingList').append("<tr><td>"+count+"</td><td> "+item['item']+"</td><td>"+item['item']+"</td><td>₦ "+item['amount']+".00</td><td>"+item['date']+"</td></tr>");
              count++;
            }
          });
          $('#specialShoppingList').append('<tr><td colspan="3" class="v-align: right;"> Total</td><td>₦ '+totalAmount+'.00</td></tr>');
          $('#std').html('<h3>Special Shopping History ( '+data.name+' '+data.regNum+')</h3>');
        });

    });

    // NEW SPECIAL SHOPPING FORM
    $('body').on('submit', '#specialForm', function(e){
          e.preventDefault();
          var studentID = localStorage.getItem('currentStudent');
          var userID = localStorage.getItem('userID');
          var amount = parseInt($('#amount').val());
          var item = $('#item').val();
         

          data = JSON.stringify({studentID:studentID, amount:amount, item: item, userID: userID});

        req = $.ajax({
          url: 'http://localhost:5000/transactions',
          type:'post',
          contentType: "application/json; charset=utf-8",
          dataType: "json",
          data: data
        });
        req.done(function(data){
          if(data.status="success"){
            $.notify({
                      title: "Action Complete : ",
                      message: "Operation Successful!",
                      icon: 'fa fa-check' 
                      },{
                          type: "info"
            });
            $('#specialForm')[0].reset();
          }
        });
    });    
    </script>
  </body>
</html>